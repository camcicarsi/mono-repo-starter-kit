# TestMono Template

<a alt="Nx logo" href="https://nx.dev" target="_blank" rel="noreferrer"><img src="https://raw.githubusercontent.com/nrwl/nx/master/images/nx-logo.png" width="45"></a>

✨ **This workspace has been generated by [Nx, a Smart, fast and extensible build system.](https://nx.dev)** ✨


## Create Project with Terminal Command
 

```bash
npx create-nx-workspace {name} --preset=nest --ci=github --commit.email={githubmail} --defaultBase=master --docker=true --name={workspaceName} --appName={api app name} --nxCloud=false
```

```bash
npm install -D @nx/angular
nx g @nx/angular:app web --style=scss --routing=true --linter=eslint --unitTestRunner=jest --e2eTestRunner=cypress --tags=scope:web,type:app --directory=apps --frontendProject={frontend app name}
```

```bash
nx g @nx/js:lib constants --directory libs --buildable --importPath=@test-mono/constants --tags=scope:constants,type:lib --unitTestRunner=none --linter=eslint
```

```bash
nx g @nx/js:lib main-database --directory libs --buildable --importPath=@test-mono/main-database
```

```bash
npm install --save @nestjs/typeorm typeorm pg
```


## Install PostGIS & pgAdmin4

```bash
curl -fsS https://www.pgadmin.org/static/packages_pgadmin_org.pub | sudo gpg --dearmor -o /usr/share/keyrings/packages-pgadmin-org.gpg
```

```bash
sudo sh -c 'echo "deb [signed-by=/usr/share/keyrings/packages-pgadmin-org.gpg] https://ftp.postgresql.org/pub/pgadmin/pgadmin4/apt/$(lsb_release -cs) pgadmin4 main" > /etc/apt/sources.list.d/pgadmin4.list && apt update'
```

```bash
sudo apt install pgadmin4-desktop
```

```bash
docker pull postgis/postgis
```

```bash
sudo docker run --name farmolog-postgis -e POSTGRES_PASSWORD=123456 -p 5432:5432 -d postgis/postgis
```

Then create a new server in pgAdmin4 with the following credentials:

```bash
Host: localhost
Port: 5432
Maintenance database: postgres
Username: postgres
Password: 123456
```

Then create a new database named `test-mono-main-db` and user named `test-mono-user` with password `123456` and grant all privileges to the user.
```sql
CREATE DATABASE "test-mono-main-db";
```

```sql
CREATE USER "test-mono-user" WITH LOGIN PASSWORD '123456';
```

```sql
GRANT ALL PRIVILEGES ON DATABASE "test-mono-main-db" TO "test-mono-user";
```
## Give Login permission to the user
```sql
ALTER ROLE "test-mono-user" WITH LOGIN;
```

Then connect to the database with the following credentials:

```bash
Host: localhost
Port: 5432
Maintenance database: test-mono-main-db
Username: test-mono-user
Password: 123456
```

Then install the postgis extension in the database with the following
```sql
CREATE EXTENSION postgis;
```

write the following query to check if the extension is installed:

```sql
SELECT PostGIS_version();
```

## Create 

## Connect to the database with TypeORM

```bash
npm install --save @nestjs/typeorm typeorm pg
```

```bash
npm install --save-dev @types/pg
```

```bash
npm install --save-dev @types/node
```

```bash
npm install --save-dev @types/geojson
```

### Create folder to "main-database" lib

```bash
mkdir libs/main-database/src/lib/entities
```

### Create file to "main-database" lib

```bash
touch libs/main-database/src/lib/entities/geojson.entity.ts
```

### Write the following code to "geojson.entity.ts"

```typescript
import { Column, Entity, PrimaryGeneratedColumn } from 'typeorm';
import { Geometry } from 'geojson';

@Entity()
export class GeoJson {
  @PrimaryGeneratedColumn()
  id: number;

  @Column({ type: 'geometry', spatialFeatureType: 'Point', srid: 4326 })
  point: Geometry;
}
```

## Create Initial Migration

```bash
npm run migration:generate -name="InitalTest"
```


## If necessary;  Install Redis & RedisInsight, RabbitMQ & RabbitMQ Management with Docker

```bash
docker pull redis
```

```bash
docker run --name farmolog-redis -p 6379:6379 -d redis
```

```bash
docker pull redislabs/redisinsight
```

```bash
docker run -v redisinsight:/db -p 8001:8001 -d --name farmolog-redisinsight redislabs/redisinsight
```

Then go to `http://localhost:8001` and connect to the redis server with the following credentials:

```bash

Host: localhost
Port: 6379
Password: 123456
```


```bash
docker pull rabbitmq
```

```bash
docker run -d --hostname farmolog-rabbitmq --name farmolog-rabbitmq -p 15672:15672 -p 5672:5672 rabbitmq:3-management
```

Then go to `http://localhost:15672` and login with the following credentials:

```bash
Username: guest
Password: guest
```
